name: Node.js Package

on:
  release:
    types: [created] # Recommended trigger for stable package releases

jobs:
  build:
    runs-on: ubuntu-latest

    permissions:
      id-token: write # Allows OIDC token generation (Required for Trusted Publishing)
      contents: read  # Allows checking out the repository

    steps:
      - name: ğŸ“¦ Checkout repository
        uses: actions/checkout@v4
        
      - name: âš™ï¸ Setup Node.js environment
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          # NOTE: registry-url is no longer required for authentication
          # but should be included if you need to use npm commands for
          # private registries/scopes, or older npm versions.
      - name: Update npm
        run: npm install -g npm@latest
          
      - name: â¬‡ï¸ Install dependencies
        run: npm ci
        
      - name: ğŸ—ï¸ Build package
        run: npm run build
        
      - name: ğŸš€ Publish to npm
        # The npm CLI (v11.5.1+) automatically uses the OIDC token 
        # for authentication when run in a trusted workflow.
        run: npm publish
